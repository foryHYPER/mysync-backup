# Admin-System Dokumentation

## üìã √úbersicht

Das Admin-System ist die zentrale Verwaltungsschnittstelle f√ºr MySync. Administratoren haben vollst√§ndigen Zugang zu allen Systemfunktionen.

## üéØ Admin-Dashboard Features

### 1. ÔøΩÔøΩ‚Äç‚ôÇÔ∏è Pool-Management (v2.1.0) - **Erweitert!**
- **Pools erstellen/bearbeiten** - Erweiterte Pool-Verwaltung mit Limits
- **Pool-Zuweisungen** - Kandidaten mit automatischer Limit-Validierung
- **Unternehmens-Zugang** - Vollst√§ndiges Berechtigungsmanagement
- **Pool-Analytics** - Real-time Metriken und erweiterte Reports

#### **üî• Neue Features in v2.1.0:**
- ‚úÖ **Pool-Limit Validierung** - Automatische Pr√ºfung beim Kandidaten hinzuf√ºgen
- ‚úÖ **Erweiterte Pool-Bearbeitung** - Responsive Dialog (896px breit)
- ‚úÖ **Unternehmensberechtigung-Management** - Vollst√§ndige CRUD-Funktionen
- ‚úÖ **Live-Validierung** - Sofortige R√ºckmeldung bei Eingaben
- ‚úÖ **Bulk-Operationen** - Effiziente Massenbearbeitung

### 2. üìÑ Lebenslauf-Management
- **Resume-√úbersicht** - Alle hochgeladenen Lebensl√§ufe verwalten
- **Qualit√§tskontrolle** - Lebensl√§ufe bewerten und freigeben
- **Download-Funktion** - PDF-Lebensl√§ufe herunterladen
- **Analyse-Tools** - Skills-Extraktion und Bewertung

### 3. üë• Benutzer-Management
- **Kandidaten verwalten** - Profile, Skills, Status
- **Unternehmen verwalten** - Firmendaten, Kontakte
- **Rollen-Zuweisung** - Admin/Company/Candidate Rollen
- **Benutzer-Analytics** - Aktivit√§ts-Tracking

### 4. üìä Analytics & Reporting
- **Pool-Performance** - Erfolgsmetriken pro Pool
- **Matching-Statistiken** - Kandidaten-Unternehmen Matches
- **System-Metriken** - Nutzungsstatistiken
- **Export-Funktionen** - Daten-Export f√ºr Reports

## üîó Navigation

### Haupt-Men√º
```
/dashboard/admin/
‚îú‚îÄ‚îÄ üìä Dashboard (√úbersicht)
‚îú‚îÄ‚îÄ üèä‚Äç‚ôÇÔ∏è Pools
‚îÇ   ‚îú‚îÄ‚îÄ Pools-√úbersicht
‚îÇ   ‚îú‚îÄ‚îÄ Pool-Details
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Kandidaten-Tab        # Pool-Kandidaten verwalten
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Unternehmen-Tab       # Zugriffsberechtigungen (NEU!)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Analytics-Tab         # Statistiken und Reports
‚îÇ   ‚îî‚îÄ‚îÄ Zuweisungen
‚îú‚îÄ‚îÄ üë• Kandidaten
‚îú‚îÄ‚îÄ üè¢ Unternehmen
‚îú‚îÄ‚îÄ üìÑ Lebensl√§ufe
‚îú‚îÄ‚îÄ üìä Analytics
‚îî‚îÄ‚îÄ ‚öôÔ∏è Einstellungen
```

## üéØ Wichtige URLs

| Feature | URL | Beschreibung |
|---------|-----|--------------|
| **Dashboard** | `/dashboard/admin` | Haupt-Dashboard |
| **Pools** | `/dashboard/admin/pools` | Pool-Verwaltung |
| **Pool-Details** | `/dashboard/admin/pools/[id]` | Einzelner Pool mit erweiterten Features |
| **Zuweisungen** | `/dashboard/admin/pools/assignments` | Pool-Zuweisungen |
| **Kandidaten** | `/dashboard/admin/candidates` | Kandidaten-Liste |
| **Unternehmen** | `/dashboard/admin/companies` | Unternehmen-Liste |
| **Lebensl√§ufe** | `/dashboard/admin/resumes` | Resume-Management |
| **Pool erstellen** | `/dashboard/admin/pools/create` | Neuen Pool anlegen |

## ‚ú® Neue Features (v2.1.0) - **Erweitert!**

### üèä‚Äç‚ôÇÔ∏è Erweitertes Pool-Management System

#### **Pool-Limit Validierung:**
```typescript
// Automatische Pr√ºfung beim Kandidaten hinzuf√ºgen
if (pool?.max_candidates) {
  const totalAfterAdding = currentCandidates + newCandidates;
  
  if (totalAfterAdding > pool.max_candidates) {
    // Fehler: Pool-Limit erreicht
    showError(`Pool-Limit erreicht! Maximal ${pool.max_candidates} erlaubt.`);
    return;
  }
  
  if (totalAfterAdding > pool.max_candidates * 0.8) {
    // Warnung: Pool fast voll
    showWarning(`Pool ist fast voll! Noch ${remaining} Pl√§tze verf√ºgbar.`);
  }
}
```

#### **Erweiterte Pool-Bearbeitung:**
- üîß **Breiter Dialog** (896px statt 672px)
- üì± **Scrollbar-Unterst√ºtzung** f√ºr kleine Bildschirme
- üé® **Zwei-Spalten Layout** f√ºr Pool-Typ und Status
- ‚úÖ **Live-Validierung** mit farbkodiertem Feedback
- üìä **Kontextuelle Informationen** √ºber aktuellen Pool-Status

#### **üî• Unternehmensberechtigung-Management (NEU!):**

**Drei Zugriffslevel:**
| Level | Berechtigung | Beschreibung |
|-------|-------------|--------------|
| **Anzeigen** | `view` | Nur Pool-Kandidaten ansehen |
| **Ausw√§hlen** | `select` | Kandidaten ansehen und ausw√§hlen |
| **Kontaktieren** | `contact` | Vollzugriff: ansehen, ausw√§hlen, kontaktieren |

**Verf√ºgbare Aktionen:**
- ‚úÖ **Berechtigung bearbeiten** - Zugriffslevel und Einstellungen √§ndern
- ‚úÖ **Zugang entfernen** - Unternehmen komplett aus Pool entfernen
- ‚úÖ **Ablaufdatum setzen** - Zeitlich begrenzten Zugang definieren
- ‚úÖ **Notizen hinzuf√ºgen** - Interne Vermerke f√ºr Tracking

#### **Berechtigungs-Bearbeitungsdialog:**
```typescript
interface CompanyAccessEdit {
  access_level: "view" | "select" | "contact";
  expires_at: Date | null;  // null = unbegrenzt
  notes: string | null;     // Interne Vermerke
}
```

### üìÑ Resume-Management System
Das bew√§hrte Lebenslauf-Management mit:
- ‚úÖ **Alle Lebensl√§ufe einsehen** - Zentrale √úbersicht
- ‚úÖ **Qualit√§ts-Bewertung** - Score von 1-100
- ‚úÖ **Status-Management** - Pending/Approved/Rejected/Under Review
- ‚úÖ **Download-Funktion** - PDF-Downloads f√ºr echte Dateien

## üöÄ H√§ufige Admin-Aufgaben

### Erweiterte Pool-Verwaltung

#### **1. Pool mit Limit erstellen**
```typescript
// Pool-Erstellung mit automatischer Validierung
const newPool = {
  name: "Senior Developers Q1 2024",
  description: "Top JavaScript Entwickler",
  max_candidates: 25,        // NEU: Pool-Limit
  pool_type: "featured",
  status: "active"
};
```

#### **2. Unternehmensberechtigung verwalten**
```
Pool-Details ‚Üí "Unternehmen" Tab ‚Üí ‚öôÔ∏è Aktionen ‚Üí "Berechtigung bearbeiten"

Workflow:
1. Neukunde       ‚Üí access_level: "view"
2. Nach Bew√§hrung ‚Üí Upgrade auf "select"  
3. Premium-Kunde  ‚Üí Upgrade auf "contact"
4. Testphase      ‚Üí expires_at setzen
5. K√ºndigung      ‚Üí Zugang entfernen
```

#### **3. Kandidaten mit Limit-Pr√ºfung hinzuf√ºgen**
```
Pool-Details ‚Üí "Kandidaten" Tab ‚Üí "Kandidaten hinzuf√ºgen"

System pr√ºft automatisch:
‚úÖ Pool-Limit nicht √ºberschritten
‚ö†Ô∏è Warnung bei 80% Auslastung
‚ùå Blockierung bei √úberschreitung
```

### Pool-Performance √ºberwachen
1. **Pool-Analytics in Dashboard**
   - Real-time Statistiken
   - Skill-√úbersichten
   - Auswahlstatistiken pro Unternehmen

2. **Workflow-Beispiel:**
   ```
   Pool "test3" ‚Üí 4 Kandidaten bei Limit 2
   ‚Üí Warnung: "Pool-Limit √ºberschritten!"
   ‚Üí Aktion: Limit erh√∂hen oder Kandidaten entfernen
   ```

### Resume-Management
1. **Lebensl√§ufe √ºberpr√ºfen**
   - Zu `/dashboard/admin/resumes`
   - Nach Status filtern (pending)
   - Qualit√§t bewerten

2. **Lebenslauf genehmigen/ablehnen**
   - Lebenslauf in Liste √∂ffnen
   - "Genehmigen" oder "Ablehnen"
   - Optional: Reviewer-Notizen hinzuf√ºgen

## üìä KPIs & Metriken

### Erweiterte Pool-Performance
- **Pool-Auslastung:** Kandidaten vs. Limit (neu!)
- **Zugriffslevel-Verteilung:** View/Select/Contact Ratio
- **Tempor√§re Zugriffe:** Ablaufende Berechtigungen
- **Successful Matches:** Kontakte/Einstellungen

### Pool-Limit Analytics
```typescript
interface PoolMetrics {
  totalCandidates: number;
  maxCandidates: number;
  utilization: number;        // % Auslastung
  warningThreshold: number;   // 80% Warnung
  limitExceeded: boolean;     // Limit √ºberschritten
}
```

### Resume-Qualit√§t
- **Durchschnittlicher Quality Score:** Gesamt-Bewertung
- **Approval Rate:** % genehmigte Lebensl√§ufe
- **Review Time:** Durchschnittliche Bearbeitungszeit
- **Download Rate:** % heruntergeladene Lebensl√§ufe

## üîß Setup & Konfiguration

### 1. Admin-Benutzer erstellen
```sql
-- Admin-Benutzer in Supabase erstellen
INSERT INTO profiles (id, email, role, first_name, last_name)
VALUES (
  'admin-user-id',
  'admin@example.com',
  'admin',
  'System',
  'Administrator'
);
```

### 2. Erweiterte Berechtigungen pr√ºfen
Das Admin-System nutzt erweiterte Row Level Security (RLS) Policies:
- ‚úÖ Admin kann alle Pool-Daten einsehen und bearbeiten
- ‚úÖ Sichere Pool-Berechtigungs-Verwaltung
- ‚úÖ Unternehmenszugriff-Kontrolle
- ‚úÖ Pool-Limit Durchsetzung

### 3. Pool-System Setup
```sql
-- Pool-Limits aktivieren (bereits vorhanden)
ALTER TABLE candidate_pools 
ADD COLUMN IF NOT EXISTS max_candidates INTEGER;

-- Berechtigungs-Management (bereits vorhanden)
-- Tabelle: pool_company_access mit access_level, expires_at, notes
```

## üîí Sicherheit

### Erweiterte Zugangskontrollen
- ‚úÖ **Pool-Limit Durchsetzung** - Verhindert √úberschreitung
- ‚úÖ **Berechtigungs-Validierung** - Sichere Access-Level Verwaltung
- ‚úÖ **Temporal Access Control** - Ablaufende Zugriffe
- ‚úÖ **Audit-Logging** - Alle Pool-√Ñnderungen werden geloggt

### Pool-spezifische Sicherheit
```typescript
// Validierung bei Pool-Operationen
if (!isAdmin(user)) throw new Error("Insufficient privileges");
if (candidateCount + newCandidates > poolLimit) {
  throw new Error("Pool capacity exceeded");
}
if (accessLevel === "contact" && !isPremiumCompany(company)) {
  throw new Error("Contact access requires premium subscription");
}
```

## üÜò Troubleshooting

### H√§ufige Pool-Management Probleme

1. **Pool-Limit Fehler**
   ```
   Error: Pool-Limit erreicht!
   ‚Üí L√∂sung: Limit erh√∂hen oder Kandidaten entfernen
   ```

2. **Berechtigungs-Update Fehler**
   ```
   Error: Could not find 'updated_at' column
   ‚Üí L√∂sung: updated_at aus Update entfernt (bereits behoben)
   ```

3. **Unternehmen kann Pool nicht sehen**
   - Pool-Zugriffsberechtigung pr√ºfen
   - Access-Level validieren (view/select/contact)
   - Ablaufdatum pr√ºfen

### Debug-Scripts
```bash
# Pool-System testen
npm run test-pool-routes

# Pool-Limits pr√ºfen
npx tsx scripts/debug-pool-limits.ts

# Berechtigungs-System testen
npx tsx scripts/debug-company-access.ts

# Datenbank-Status pr√ºfen
npx tsx scripts/debug-pool-companies.ts
```

### Pool-Debugging
```typescript
// Pool-Status pr√ºfen
console.log('Pool Health Check:', {
  id: pool.id,
  candidateCount: candidates.length,
  maxCandidates: pool.max_candidates,
  utilization: (candidates.length / pool.max_candidates) * 100,
  companiesWithAccess: companies.length,
  warningThreshold: pool.max_candidates * 0.8
});
```

## üìû Support

Bei Admin-spezifischen Problemen:
1. **[Pool-Management Docs](./pool-management.md)** - **NEU!** Detaillierte Pool-Verwaltung v2.1.0
2. **[Resume-Management Docs](./resume-management.md)** - Lebenslauf-Verwaltung
3. **[User-Management Docs](./user-management.md)** - Benutzer-Verwaltung
4. **[Troubleshooting](../deployment/troubleshooting.md)** - Technische Probleme

## üìã Changelog

### Version 2.1.0 (Dezember 2024) - **Aktuell**
- üî• **Pool-Limit Validierung** mit automatischer Pr√ºfung
- üî• **Erweiterte Pool-Bearbeitung** mit responsivem Dialog (896px)
- üî• **Unternehmensberechtigung-Management** komplett neu implementiert
- üî• **Live-Validierung** mit sofortigen R√ºckmeldungen
- üî• **Bulk-Operationen** f√ºr effiziente Massenbearbeitung
- üîß **Bug-Fixes** f√ºr Pool-Zugriffe und Validierung

### Version 2.0.0 (November 2024)
- Pool-System Grundlagen implementiert
- Kandidaten-Zuweisungen
- Basis Unternehmenszugriff
- Admin Dashboard Integration

### Version 1.0.0 (Oktober 2024)
- Resume Management System
- Basis Admin-Funktionen
- Benutzer-Verwaltung

---

**Admin-System Version:** 2.1.0 | **Letzte Aktualisierung:** Dezember 2024 